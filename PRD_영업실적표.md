
# 영업실적표 관리 시스템 - PRD(제품 요구사항 문서)

# 1. 개요
영업실적표 관리 시스템은 영업팀이 월별, 국가별, 모델별 영업 실적을 효율적으로 관리하고 모니터링할 수 있는 웹 기반 애플리케이션입니다. 사용자는 실시간으로 영업 데이터를 입력, 수정하고 버전 관리를 통해 변경 이력을 추적할 수 있습니다.


# 2. 기술 스택
## 2.1 프론트엔드
- 기본 프레임워크: React (v18.3.1), TypeScript
- 상태 관리: React Query (v5.56.2), React Hooks
- UI 컴포넌트:
  . Shadcn UI (구성 컴포넌트)
  . Radix UI Primitives (기본 UI 요소)
  . Lucide React (아이콘)
- 스타일링: Tailwind CSS
- 데이터 그리드: Handsontable (v15.1.0), @handsontable/react (v15.1.0)
- 데이터 시각화: Recharts (v2.12.7, 차트 컴포넌트)
- 폼 처리: React Hook Form (v7.53.0)
- 데이터 검증: Zod (v3.23.8)
- 날짜 처리: date-fns (v3.6.0)
- 라우팅: React Router DOM (v6.26.2)
- 알림 컴포넌트: sonner (v1.5.0, 토스트 알림)
- 빌드 도구: Vite
- 패키지 매니저: Bun

## 2.2 백엔드
- 언어: Python 3.11
- 프레임워크: FastAPI (≥0.95.0)
- ORM: SQLAlchemy (≥2.0.0)
- 데이터 검증: Pydantic (≥2.0.0)
- 인증: Python-Jose (≥3.3.0), Passlib (≥1.7.4)
- 마이그레이션: Alembic (≥1.10.0)
- 데이터베이스 연결: PyMySQL (≥1.0.2)
- 파일 업로드: Python-Multipart (≥0.0.6)
- 환경 변수: Python-Dotenv (≥1.0.0)
- 암호화: Cryptography (≥40.0.0)
- 서버: Uvicorn (≥0.21.1)

## 2.3 데이터베이스
- DBMS: MySQL
- DB명: sales_performance_db
- 테이블:
  . versions: 버전 관리 테이블
  . sales_data: 영업실적표 메인 테이블
  . countries: 국가 정보 테이블
  . regions: 지역 정보 테이블
  . models: 모델 정보 테이블
  . users: 사용자 정보 테이블
  . change_history: 변경 이력 테이블

## 2.4 인프라
- 컨테이너화: Docker
- 멀티 컨테이너 관리: Docker Compose
- 환경 설정: 환경 변수(.env) 기반 설정


# 3. 아키텍처
## 3.1 프론트엔드 아키텍처
- 컴포넌트 기반: 재사용 가능한 컴포넌트로 구성
- 커스텀 훅 패턴: 로직과 UI 분리를 위한 다양한 커스텀 훅 구현
- 계층 구조:
  . 페이지 컴포넌트 (routes)
  . 기능 컴포넌트 (components)
  . 유틸리티 함수 (utils)
  . API 클라이언트 (api)
  . 커스텀 훅 (hooks)
- 상태 관리: 커스텀 훅을 사용한 모듈화된 상태 관리
  . useSalesPerformance: 최상위 통합 훅
  . useTableState: 테이블 데이터 상태 관리
  . useEditMode: 편집 모드 상태 관리
  . useVersionManagement: 버전 관리 로직
  . useSalesHistory: 변경 이력 관리
  . useChangeManagement: 변경 관리 로직
  . useDataLoading: 데이터 로딩 관리
  . useHighlighting: 셀 하이라이팅 관리
- UI 컴포넌트:
  . SalesPerformanceTable: 메인 컨테이너 컴포넌트
  . SalesTableHeader: 테이블 컨트롤 섹션
  . SalesHotTable: Handsontable 래퍼 컴포넌트
  . SalesHistoryDialog: 변경 이력 다이얼로그
  . HistoryVersionItem: 버전 이력 아이템 컴포넌트
  . HistoryChangeTable: 변경 내역 테이블 컴포넌트

## 3.2 백엔드 아키텍처
- RESTful API: HTTP 메서드 기반 API 설계
- 라우터 기반 구조: 기능별 라우터 분리
- ORM 기반 데이터 접근: SQLAlchemy를 통한 데이터베이스 상호작용
- 의존성 주입 패턴: FastAPI의 의존성 주입 기능 활용
- 서비스 계층: 비즈니스 로직 처리를 위한 서비스 계층 구현
  . versionService: 버전 관리 서비스
  . salesDataService: 영업 데이터 서비스
  . changeHistoryService: 변경 이력 서비스
  . userService: 사용자 관리 서비스

## 3.3 데이터 모델
- 데이터 구조:
  . 2차원 배열 형태의 테이블 데이터
  . 버전별 데이터 저장 객체(versionData)
  . 변경 이력 객체 배열(versionHistory)
  . 계층형 구조: 총합계 > 지역 > 국가 > 모델
- 변경 감지 시스템:
  . 원본 데이터(originalData)와 현재 데이터 비교
  . 변경된 셀 집합(changedCells) 관리
  . 변경 이력 객체(CellChange) 타입 정의

## 3.4 성능 최적화
- 메모이제이션: useMemo와 React.memo를 활용한 불필요한 리렌더링 방지
- 렌더링 최적화: 테이블 렌더링 옵션 최적화(선택적 렌더링, 뷰포트 제한 등)
- 데이터 처리 최적화: 깊은 복사를 통한 참조 문제 방지
- 캐싱 전략: React Query를 활용한 데이터 캐싱
- DOM 최적화: will-change 속성 사용으로 하드웨어 가속 활용
- 데이터 로딩 최적화: 필요한 데이터만 선택적으로 로드하는 지연 로딩 구현


# 4. 핵심 기능
## 4.1 영업실적표 표시 및 관리
- 표 구조: Handsontable을 활용한 스프레드시트 형태의 복합적인 헤더 구조를 가진 표 형식으로 데이터 표시
  . 행: 국가 및 모델별 데이터
  . 열: 12개월 x (5개 카테고리 x 2(Qty/Amt) + 비고 1) = 132개 열
- 데이터 카테고리: 전년, 계획, 실행, 속보, 전망 (각각 수량/금액) 및 비고
- 지역별 구분: 국가별, 지역별, 총합계 레벨의 데이터 표시
- 행 구분: 
  . '총 합계' - 전체 합계 행 (Level 1)
  . '미주', '구주' - 지역 행 (Level 2)
  . '미국', '캐나다', '영국', '이태리' - 국가 행 (Level 3)
  . '모델1', '모델2' - 모델 행 (Level 3 하위)

## 4.2 데이터 편집 기능
- 편집 모드: 최신 버전에서만 편집 가능한 토글식 편집 모드
- 셀 수정: 특정 조건(국가/모델 레벨, 실제 데이터 셀)에서만 수정 가능
- 자동 계산: 국가, 지역, 총합계 레벨의 합계 자동 계산
- 유효성 검사: 입력 데이터에 대한 유효성 검사 및 포맷팅
- 데이터 변환: 숫자 포맷팅(천 단위 구분자, 소수점 등) 자동 적용
- 편집 취소: 변경 사항 취소 및 원래 상태로 복원 기능

## 4.3 버전 관리 시스템
- 버전 생성: 변경사항 저장 시 새 버전 자동 생성(revX 형식)
- 버전 선택: 드롭다운을 통해 특정 버전으로 이동 가능
- 초기 버전 보호: rev1(초기 버전)은 수정 불가 설정
- 최신 버전 표시: 현재 보고 있는 버전이 최신인지 여부 표시
- 버전 데이터 관리: 각 버전별 독립 데이터 저장 및 관리
- 버전 전환 효과: 버전 간 스무스한 전환을 위한 애니메이션 적용

## 4.4 변경 이력 관리
- 변경 감지: 사용자 입력 시 셀 단위 변경 감지
- 변경 하이라이팅: 수정된 셀 시각적 하이라이팅
- 변경 이력 저장: 변경사항을 시간, 사용자, 위치, 변경 전/후 값 포함하여 저장
- 변경 이력 보기: 모달 다이얼로그를 통해 모든 변경 이력 조회
- 변경 내역 필터링: 실제 변경된 내용만 필터링하여 표시
- 변경 이력 확장/축소: 아코디언 형태로 변경 내역 상세 확인

## 4.5 데이터 필터링
- 연도 선택: 연도별 데이터 필터링(현재 2025년)
- 월 선택: 월별 데이터 필터링(현재 3월)
- 주차 선택: 주차별 데이터 필터링(현재 W12)
- 즉시 적용: 필터 변경 시 데이터 즉시 업데이트

## 4.6 데이터 계산 및 분석
- 자동 합산: 모델 > 국가 > 지역 > 총합계 순으로 데이터 자동 집계
- 계산 최적화: 필요한 부분만 재계산하는 최적화 알고리즘
- 데이터 검증: 입력값 및 계산 결과 검증
- 성능 처리: 대용량 데이터 고속 처리를 위한 계산 최적화


# 5. 사용자 인터페이스
## 5.1 메인 화면
- 헤더: 페이지 제목 및 응용 프로그램 식별
- 테이블 컨트롤 섹션: 필터링, 버전 선택, 편집 모드 제어 버튼 등
- 데이터 테이블: 핵심 컴포넌트로, Handsontable 라이브러리 기반 구현
- 푸터: 저작권 정보 및 애플리케이션 메타데이터
- 애니메이션: 페이지 전환 및 로딩 애니메이션 적용

## 5.2 테이블 헤더
- 필터 컨트롤: 연도, 월, 주차 선택용 드롭다운
- 버전 선택 컨트롤: 버전 선택용 드롭다운
- 변경 이력 버튼: 변경 이력 다이얼로그 열기 버튼
- 편집 컨트롤: 편집 모드 토글 및 저장 버튼
- 버전 표시: 현재 선택된 버전 정보 표시
- 편집 불가 알림: 최신 버전이 아닐 때 편집 버튼 비활성화 및 알림

## 5.3 변경 이력 다이얼로그
- 버전별 목록: 변경 이력 아코디언 형태로 정렬
- 변경 상세 정보: 국가, 월, 구분, 모델, 항목, 변경 전/후 값 표시
- 버전 이동: 특정 버전으로 빠르게 이동할 수 있는 버튼
- 변경 이력 확장/축소: 각 버전의 변경 내역 확장/축소 가능
- 변경 건수 표시: 각 버전별 변경된 건수 표시
- 날짜/시간 포맷: 사용자 친화적인 날짜 및 시간 형식 적용


# 6. UI/UX 디자인 원칙
## 6.1 시각적 디자인
- 색상 체계:
  . 기본: 흰색 배경, 회색 테두리, 파란색 강조
  . 편집 모드: 밝은 회색 배경(#f9f9f9)으로 편집 가능한 셀 표시
  . 변경 셀: 하이라이팅(#FEF7CD)으로 변경된 셀 표시
  . 계층별 색상: 총합계(#1e2761), 지역(#333333), 국가(#f2f2f2)
  . 헤더 색상: 연한 파스텔 블루-그레이(#EEF1F5), 네이비 텍스트(#3E4C63)
- 레이아웃: 반응형 디자인으로 다양한 화면 크기 지원
- 타이포그래피: 읽기 쉬운 폰트(Pretendard)와 적절한 크기 계층 구조
- 그리드 시스템: 일관된 간격과 정렬로 시각적 질서 제공
- 아이콘: Lucide React 아이콘을 활용한 직관적인 기능 표시
- 애니메이션: 부드러운 전환 효과로 사용자 경험 향상

## 6.2 사용자 경험
- 피드백: 토스트 메시지를 통한 작업 성공/실패 알림
- 안내: 툴팁 및 인터랙티브 요소를 통한 사용자 가이드
- 일관성: 전체 인터페이스에 걸쳐 일관된 상호작용 패턴
- 액세스 가능성: 키보드 탐색 및 스크린 리더 지원
- 오류 처리: 명확한 오류 메시지와 복구 방법 제공
- 로딩 상태: 데이터 로딩 중 시각적 피드백 제공
- 반응 시간: 사용자 입력에 대한 즉각적인 시스템 반응


# 7. 미래 확장 가능성
## 7.1 기능 확장
- 데이터 내보내기/가져오기: Excel, CSV 형식 지원
- 사용자 관리: 다중 사용자 및 권한 관리
- 데이터베이스 연동: 백엔드 API를 통한 데이터 영구 저장
- 커스텀 필터링: 다양한 조건으로 데이터 필터링
- 고급 분석: 차트 및 시각화 도구 추가
- 알림 시스템: 중요 변경사항에 대한 알림 기능
- 협업 기능: 동시 편집 및 변경 내용 실시간 공유

## 7.2 기술 향상
- GraphQL 지원: REST API 외에 GraphQL API 추가
- 오프라인 모드: 네트워크 연결 없이도 작업 가능한 오프라인 모드
- 서비스 워커: 캐싱 및 백그라운드 동기화를 위한 서비스 워커 통합
- 리얼타임 업데이트: 웹소켓을 활용한 실시간 데이터 동기화
- 멀티 디바이스 지원: 태블릿, 모바일 최적화 UI
- AI 기반 기능: 예측 분석 및 자동 데이터 처리

# 8. 배포 및 운영
## 8.1 배포 전략
- 컨테이너 기반 배포: Docker 컨테이너로 패키징
- 환경 분리: 개발, 테스트, 프로덕션 환경 분리
- CI/CD: 지속적 통합 및 배포 파이프라인 구성
- 버전 관리: 시맨틱 버저닝 적용

## 8.2 운영 관리
- 모니터링: 애플리케이션 상태 및 성능 모니터링
- 로깅: 중요 이벤트 및 오류 로깅
- 백업 및 복구: 데이터 백업 및 복구 전략
- 보안: 정기적인 보안 업데이트 및 취약점 검사
